<!DOCTYPE html>
<html>
<head>
    <title>Resep Masakan</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .card { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 8px; display: flex; gap: 15px; align-items: center; }
        .card img { border-radius: 5px; }
        button { cursor: pointer; background: #ff6b6b; color: white; border: none; padding: 8px 15px; border-radius: 5px; }
        #detail-area { background: #f9f9f9; padding: 20px; border: 2px dashed #ccc; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <h1>üç≤ Cari Resep Masakan</h1>
    <input type="text" id="keyword" placeholder="Mau masak apa? (misal: Ayam)" style="padding: 8px; width: 300px;">
    <button onclick="cariResep()">Cari</button>

    <div id="detail-area">
        <h2 id="judul-detail"></h2>
        <img id="gambar-detail" width="200" style="margin-bottom: 10px;">
        <h3>Bahan-bahan:</h3>
        <ul id="list-bahan"></ul>
        <h3>Cara Masak:</h3>
        <p id="instruksi"></p>
        <button onclick="tutupDetail()" style="background: #555;">Tutup</button>
    </div>

    <div id="hasil" style="margin-top: 20px;"></div>

    <script>
        // 1. Fungsi Mencari Resep
        async function cariResep() {
            const kata = document.getElementById('keyword').value;
            const response = await fetch(`http://localhost:3000/api/cari-resep?keyword=${kata}`);
            const data = await response.json();

            const kotakHasil = document.getElementById('hasil');
            kotakHasil.innerHTML = ''; 

            if(data.results) {
                data.results.forEach(resep => {
                    // Perhatikan tombol "Lihat Detail" di bawah ini
                    kotakHasil.innerHTML += `
                        <div class="card">
                            <img src="${resep.image}" width="100">
                            <div>
                                <h3>${resep.title}</h3>
                                <button onclick="lihatDetail(${resep.id})">Lihat Detail & Cara Masak</button>
                            </div>
                        </div>
                    `;
                });
            }
        }

        // 2. Fungsi Melihat Detail (Diklik user)
        async function lihatDetail(id) {
            // Tampilkan loading sebentar
            document.getElementById('detail-area').style.display = 'block';
            document.getElementById('judul-detail').innerText = "Sedang mengambil data...";
            
            // Panggil server backend kita
            const response = await fetch(`http://localhost:3000/api/detail-resep/${id}`);
            const data = await response.json();

            // Masukkan data ke HTML
            document.getElementById('judul-detail').innerText = data.title;
            document.getElementById('gambar-detail').src = data.image;
            document.getElementById('instruksi').innerHTML = data.instructions || "Tidak ada instruksi khusus.";

            // Masukkan bahan-bahan (Looping)
            const listBahan = document.getElementById('list-bahan');
            listBahan.innerHTML = '';
            data.extendedIngredients.forEach(bahan => {
                listBahan.innerHTML += `<li>${bahan.original}</li>`;
            });

            // Scroll ke atas biar kelihatan
            window.scrollTo(0,0);
        }

        function tutupDetail() {
            document.getElementById('detail-area').style.display = 'none';
        }
    </script>
</body>
</html>